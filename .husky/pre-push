# Quality Gates Pre-Push Hook
# Comprehensive quality verification before pushing to remote

echo "ğŸš€ Running Quality Gates Pre-Push Verification..."

# Check if we're pushing to protected branches
protected_branch='main\|master\|develop'
current_branch=$(git symbolic-ref HEAD | sed -e 's,.*/\(.*\),\1,')

if echo "$current_branch" | grep -qE "$protected_branch"; then
    echo "ğŸ”’ Pushing to protected branch: $current_branch"
    echo "ğŸ” Running comprehensive quality gates..."
    
    # Run fast quality gates suite
    if ! npm run quality:fast; then
        echo "âŒ Quality gates failed for protected branch"
        echo "All quality gates must pass before pushing to $current_branch"
        exit 1
    fi
    
    # Additional checks for protected branches
    echo "ğŸ§ª Running full test suite..."
    if ! npm run test:coverage; then
        echo "âŒ Test coverage requirements not met"
        exit 1
    fi
    
    echo "ğŸ—ï¸  Verifying production build..."
    if ! npm run build; then
        echo "âŒ Production build failed"
        exit 1
    fi
    
    echo "âœ… All quality gates passed for protected branch!"
else
    echo "ğŸ“ Pushing to feature branch: $current_branch"
    echo "ğŸ” Running standard quality checks..."
    
    # Run fast quality checks for feature branches
    if ! npm run quality:fast; then
        echo "âŒ Quality checks failed"
        echo "Fix issues before pushing"
        exit 1
    fi
    
    echo "âœ… Quality checks passed for feature branch!"
fi

echo "ğŸ‰ Ready to push!"
exit 0
